{%extends 'layouts/base.html' %} {%block title %}{{student.full_name }} -
Profile{%endblock %} {%block breadcrumb %}Students > {{student.full_name }}{%endblock %} {%block content %}
<div class="page-header flex-between">
  <div>
    <h1>ğŸ‘¤ {{student.full_name }}</h1>
    <p>Student Profile</p>
  </div>
  <div>
    <a
      href="{%url 'student_pdf' pk=student.pk %}"
      class="btn btn-success btn-sm">ğŸ“„ Download PDF</a>
    {%if request.user.role == 'admin' %}
    <a href="{%url 'student_edit' pk=student.pk %}" class="btn btn-warning">âœï¸ Edit</a>
    {%endif %}
    <a
      href="{%url 'student_list' file_id=student.file_id %}"
      class="btn btn-secondary">â† Back</a>
  </div>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px">
  <div class="card">
    <div style="text-align: center; margin-bottom: 20px">
      {%if student.photo %}
      <img
        src="{{student.photo.url }}"
        alt="Photo"
        style="
          width: 100px;
          height: 100px;
          border-radius: 50%;
          object-fit: cover;
        "
      />
      {%else %}
      <div
        style="
          width: 80px;
          height: 80px;
          border-radius: 50%;
          background: #06b6d4;
          color: #fff;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          font-size: 28px;
          font-weight: 700;
          margin: 0 auto;
        ">
        {{student.initials }}
      </div>
      {%endif %}
      <h2 style="margin-top: 10px">{{student.full_name }}</h2>
      <p style="color: #64748b">
        {{student.class_name }} | Div {{student.division }} | Roll {{student.roll_no }}
      </p>
      {%if student.status == 'normal' %}
      <span class="badge badge-success">âœ… Normal</span>
      {%elif student.status == 'marked' %}
      <span class="badge badge-warning">ğŸš© Edit Marked</span>
      {%elif student.status == 'resolved' %}
      <span class="badge badge-info">âœ… Resolved</span>
      {%endif %}
    </div>

    <h3 style="font-size: 14px; color: #64748b; margin: 15px 0 10px">
      ğŸ“‹ Personal Information
    </h3>
    <table>
      <tr>
        <td style="font-weight: 600; width: 130px">Full Name</td>
        <td>{{student.full_name }}</td>
      </tr>
      <tr>
        <td style="font-weight: 600">Phone</td>
        <td>{{student.phone|default:"Not provided" }}</td>
      </tr>
      <tr>
        <td style="font-weight: 600">Email</td>
        <td>{{student.email|default:"Not provided" }}</td>
      </tr>
      <tr>
        <td style="font-weight: 600">Address</td>
        <td>{{student.address|default:"Not provided" }}</td>
      </tr>
    </table>
  </div>

  <div>
    <div class="card">
      <h3 style="font-size: 14px; color: #64748b; margin-bottom: 10px">
        ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦ Parent / Guardian Information
      </h3>
      <table>
        <tr>
          <td style="font-weight: 600; width: 130px">Parent Name</td>
          <td>{{student.parent_name|default:"Not provided" }}</td>
        </tr>
        <tr>
          <td style="font-weight: 600">Parent Phone</td>
          <td>{{student.parent_phone|default:"Not provided" }}</td>
        </tr>
      </table>
    </div>

    <div class="card">
      <h3 style="font-size: 14px; color: #64748b; margin-bottom: 10px">
        ğŸ“ Academic Information
      </h3>
      <table>
        <tr>
          <td style="font-weight: 600; width: 130px">Class</td>
          <td>{{student.class_name }}</td>
        </tr>
        <tr>
          <td style="font-weight: 600">Division</td>
          <td>{{student.division }}</td>
        </tr>
        <tr>
          <td style="font-weight: 600">Year</td>
          <td>{{student.year }}</td>
        </tr>
        <tr>
          <td style="font-weight: 600">Roll Number</td>
          <td>{{student.roll_no }}</td>
        </tr>
        <tr>
          <td style="font-weight: 600">PRN</td>
          <td>{{student.prn }}</td>
        </tr>
      </table>
    </div>

    <div class="card">
      <h3 style="font-size: 14px; color: #64748b; margin-bottom: 10px">
        ğŸ“ File Information
      </h3>
      <table>
        <tr>
          <td style="font-weight: 600; width: 130px">Source File</td>
          <td>{{student.file.file_name }}</td>
        </tr>
        <tr>
          <td style="font-weight: 600">Academic Year</td>
          <td>{{student.file.academic_year }}</td>
        </tr>
        <tr>
          <td style="font-weight: 600">Upload Date</td>
          <td>{{student.file.upload_date|date:"d M Y" }}</td>
        </tr>
        <tr>
          <td style="font-weight: 600">Last Modified</td>
          <td>{{student.updated_at|date:"d M Y, h:i A" }}</td>
        </tr>
        <tr>
          <td style="font-weight: 600">Status</td>
          <td>{{student.get_status_display }}</td>
        </tr>
      </table>
    </div>
  </div>
</div>

<!-- Edit History for this student -->
{%if request.user.role == 'admin' %} {%with notifications=student.notifications.all %} {%if notifications %}
<div class="card" style="margin-top: 10px">
  <div class="card-header">
    <h3>ğŸ“‹ Edit Request History</h3>
  </div>
  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Requested By</th>
        <th>Field</th>
        <th>Remark</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
      {%for notif in notifications %}
      <tr>
        <td style="font-size: 12px">
          {{notif.created_at|date:"d M Y, h:i A" }}
        </td>
        <td>
          {{notif.requested_by.full_name }} ({{notif.requested_by.get_role_display }})
        </td>
        <td>{{notif.get_field_to_edit_display }}</td>
        <td style="font-size: 13px">{{notif.remark }}</td>
        <td>
          <span
            class="badge {%if notif.status == 'pending' %}badge-warning{%elif notif.status == 'resolved' %}badge-success{%else %}badge-gray{%endif %}">
            {{notif.get_status_display }}
          </span>
        </td>
      </tr>
      {%endfor %}
    </tbody>
  </table>
</div>
{%endif %} {%endwith %} {%endif %} {%endblock %}

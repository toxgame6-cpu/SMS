{%extends 'layouts/base.html' %}
{%block title %}My Profile - SMS Portal{%endblock %}
{%block breadcrumb %}Profile{%endblock %}
{%block content %}
<div class="page-header flex-between">
    <div>
        <h1>üë§ My Profile</h1>
        <p>View and edit your account details</p>
    </div>
    <a href="javascript:history.back()" class="btn btn-secondary">‚Üê Back</a>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; max-width: 900px;">
    <!-- Profile Info Card -->
    <div class="card">
        <div style="text-align: center; margin-bottom: 20px;">
            {%if request.user.photo %}
            <img src="{{request.user.photo.url }}" alt="Photo"
                style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover;" />
            {%else %}
            <div style="width: 80px; height: 80px; border-radius: 50%; background: #4f46e5; color: #fff; display: inline-flex; align-items: center; justify-content: center; font-size: 28px; font-weight: 700; margin: 0 auto;">
                {{request.user.initials }}
            </div>
            {%endif %}
            <h2 style="margin-top: 10px;">{{request.user.full_name }}</h2>
            <span class="badge badge-info">{{request.user.get_role_display }}</span>
        </div>

        <table>
            <tr>
                <td style="font-weight: 600; width: 130px;">Username</td>
                <td>{{request.user.username }}</td>
            </tr>
            <tr>
                <td style="font-weight: 600;">Email</td>
                <td>{{request.user.email }}</td>
            </tr>
            <tr>
                <td style="font-weight: 600;">Phone</td>
                <td>{{request.user.phone|default:"-" }}</td>
            </tr>
            <tr>
                <td style="font-weight: 600;">Department</td>
                <td>{{request.user.department|default:"-" }}</td>
            </tr>
            <tr>
                <td style="font-weight: 600;">Role</td>
                <td>{{request.user.get_role_display }}</td>
            </tr>
            <tr>
                <td style="font-weight: 600;">Joined</td>
                <td>{{request.user.created_at|date:"d M Y, h:i A" }}</td>
            </tr>
            <tr>
                <td style="font-weight: 600;">Last Login</td>
                <td>{{request.user.last_login|date:"d M Y, h:i A"|default:"-" }}</td>
            </tr>
        </table>

        <div style="margin-top: 20px; text-align: right;">
            <a href="{%url 'change_password' %}" class="btn btn-secondary">üîë Change Password</a>
        </div>
    </div>

    <!-- Edit Profile Card -->
    <div class="card">
        <div class="card-header">
            <h3>‚úèÔ∏è Edit Profile</h3>
        </div>

        <form method="POST" enctype="multipart/form-data">
            {%csrf_token %}
            {%if form.errors %}
            <div style="background: #fee2e2; color: #dc2626; padding: 10px 14px; border-radius: 8px; font-size: 13px; margin-bottom: 16px;">
                {%for field, errors in form.errors.items %}
                    {%for error in errors %}
                    <p>{{field }}: {{error }}</p>
                    {%endfor %}
                {%endfor %}
            </div>
            {%endif %}

            <div class="form-group">
                <label>Full Name *</label>
                {{form.full_name }}
            </div>

            <div class="form-group">
                <label>Email *</label>
                {{form.email }}
            </div>

            <div class="form-group">
                <label>Phone</label>
                {{form.phone }}
            </div>

            <div class="form-group">
                <label>Department</label>
                {{form.department }}
            </div>

            <div class="form-group">
                <label>Profile Photo</label>
                {%if request.user.photo %}
                <p style="font-size: 12px; color: #64748b; margin-bottom: 5px;">Current photo uploaded</p>
                {%endif %}
                {{form.photo }}
            </div>

            <div style="text-align: right; margin-top: 20px; padding-top: 15px; border-top: 1px solid #f1f5f9;">
                <button type="submit" class="btn btn-primary">üíæ Save Changes</button>
            </div>
        </form>
    </div>
</div>
{%endblock %}
{% extends 'layouts/base.html' %}
{% block title %}Admin Dashboard - SMS Portal{% endblock %}
{% block breadcrumb %}Admin > Dashboard{% endblock %}
{% block content %}
<div class="page-header">
  <h1>Welcome back, {{ request.user.full_name }}!</h1>
  <p>Here is your system overview</p>
</div>

<div class="stats-grid">
  <div class="stat-card">
    <div class="icon">ğŸ‘¨â€ğŸ«</div>
    <div class="value">{{ stats.total_teachers }}</div>
    <div class="label">Teachers</div>
    <a href="{% url 'teacher_list' %}" class="stat-link">Manage â†’</a>
  </div>
  <div class="stat-card">
    <div class="icon">ğŸ§‘â€ğŸ¤â€ğŸ§‘</div>
    <div class="value">{{ stats.total_guardians }}</div>
    <div class="label">Guardians</div>
    <a href="{% url 'guardian_list' %}" class="stat-link">Manage â†’</a>
  </div>
  <div class="stat-card">
    <div class="icon">ğŸ‘¨â€ğŸ’¼</div>
    <div class="value">{{ stats.total_hods }}</div>
    <div class="label">HODs</div>
    <a href="{% url 'hod_list' %}" class="stat-link">Manage â†’</a>
  </div>
  <div class="stat-card">
    <div class="icon">ğŸ“</div>
    <div class="value">{{ stats.total_students }}</div>
    <div class="label">Students</div>
    <a href="{% url 'file_list' %}" class="stat-link">Details â†’</a>
  </div>
  <div class="stat-card">
    <div class="icon">ğŸ“</div>
    <div class="value">{{ stats.total_files }}</div>
    <div class="label">Student Files</div>
    <a href="{% url 'file_list' %}" class="stat-link">Browse â†’</a>
  </div>
  <div class="stat-card">
    <div class="icon">ğŸ””</div>
    <div class="value">{{ stats.pending_notifications }}</div>
    <div class="label">Pending Requests</div>
    <a href="{% url 'notification_list' %}" class="stat-link">Review â†’</a>
  </div>
</div>

<!-- Recent Announcements -->
{% if recent_announcements %}
<div class="card dashboard-announcements">
  <div class="card-header">
    <h3>ğŸ“¢ Recent Announcements</h3>
    <a href="{% url 'announcement_list' %}" class="btn btn-secondary btn-sm">View All</a>
  </div>
  <div class="announcement-feed">
    {% for ann in recent_announcements %}
    <a href="{% url 'announcement_detail' pk=ann.pk %}" class="announcement-feed-item">
      <div class="announcement-feed-icon">{{ ann.category_emoji }}</div>
      <div class="announcement-feed-content">
        <span class="announcement-feed-title">{{ ann.title }}</span>
        <span class="announcement-feed-meta">
          {{ ann.created_at|timesince }} ago â€” {{ ann.get_category_display }}
          {% if ann.is_pinned %}<span class="badge badge-warning" style="margin-left: 6px; font-size: 9px; padding: 1px 6px;">ğŸ“Œ Pinned</span>{% endif %}
        </span>
      </div>
      <svg class="announcement-feed-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
    </a>
    {% endfor %}
  </div>
</div>
{% endif %}

<!-- Activity + Quick Actions Grid -->
<div class="dashboard-grid">
  <!-- Recent Activity -->
  <div class="card dashboard-activity">
    <div class="card-header">
      <h3>ğŸ• Recent Activity</h3>
      <a href="{% url 'audit_log' %}" class="btn btn-secondary btn-sm">View Log</a>
    </div>
    {% if recent_activity %}
    <div class="activity-list">
      {% for log in recent_activity %}
      <div class="activity-item">
        <div class="activity-dot {% if 'login' in log.action %}dot-info{% elif 'delete' in log.action %}dot-danger{% elif 'create' in log.action %}dot-success{% else %}dot-warning{% endif %}"></div>
        <div class="activity-content">
          <span class="activity-text">
            {{ log.get_action_display }}
            {% if log.user %}
            by <strong>{{ log.user.full_name }}</strong>
            {% endif %}
          </span>
          <span class="activity-time">{{ log.timestamp|timesince }} ago</span>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
      <p>No recent activity</p>
    </div>
    {% endif %}
  </div>

  <!-- Quick Actions -->
  <div class="card dashboard-actions">
    <div class="card-header">
      <h3>âš¡ Quick Actions</h3>
    </div>
    <div class="quick-actions-list">
      <a href="{% url 'teacher_create' %}" class="quick-action-item">
        <span class="quick-action-icon">ğŸ‘¨â€ğŸ«</span>
        <span class="quick-action-text">Create Teacher</span>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
      </a>
      <a href="{% url 'guardian_create' %}" class="quick-action-item">
        <span class="quick-action-icon">ğŸ§‘â€ğŸ¤â€ğŸ§‘</span>
        <span class="quick-action-text">Create Guardian</span>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
      </a>
      <a href="{% url 'hod_create' %}" class="quick-action-item">
        <span class="quick-action-icon">ğŸ‘¨â€ğŸ’¼</span>
        <span class="quick-action-text">Create HOD</span>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
      </a>
      <a href="{% url 'upload_excel' %}" class="quick-action-item">
        <span class="quick-action-icon">ğŸ“¤</span>
        <span class="quick-action-text">Upload Excel</span>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
      </a>
      <a href="{% url 'permission_list' %}" class="quick-action-item">
        <span class="quick-action-icon">ğŸ”</span>
        <span class="quick-action-text">Manage Permissions</span>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
      </a>
      <a href="{% url 'announcement_create' %}" class="quick-action-item">
        <span class="quick-action-icon">ğŸ“¢</span>
        <span class="quick-action-text">New Announcement</span>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
      </a>
    </div>
  </div>
</div>

<style>
/* ===== Dashboard Grid ===== */
.dashboard-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--spacing-md);
}

@media (max-width: 768px) {
  .dashboard-grid {
    grid-template-columns: 1fr;
  }
}

/* ===== Announcement Feed ===== */
.announcement-feed {
  display: flex;
  flex-direction: column;
}

.announcement-feed-item {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 14px 4px;
  border-bottom: 1px solid var(--border);
  text-decoration: none;
  color: inherit;
  border-radius: var(--radius-sm);
  transition: all 0.2s var(--transition-default);
}

.announcement-feed-item:last-child {
  border-bottom: none;
}

.announcement-feed-item:hover {
  background: var(--bg-hover);
  padding-left: 10px;
  padding-right: 10px;
}

.announcement-feed-icon {
  width: 40px;
  height: 40px;
  border-radius: var(--radius-sm);
  background: var(--primary-glow);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  flex-shrink: 0;
}

.announcement-feed-content {
  flex: 1;
  min-width: 0;
}

.announcement-feed-title {
  display: block;
  font-size: 14px;
  font-weight: 600;
  color: var(--text-primary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.announcement-feed-meta {
  display: block;
  font-size: 12px;
  color: var(--text-muted);
  margin-top: 2px;
}

.announcement-feed-arrow {
  color: var(--text-muted);
  flex-shrink: 0;
  opacity: 0;
  transform: translateX(-4px);
  transition: all 0.2s ease;
}

.announcement-feed-item:hover .announcement-feed-arrow {
  opacity: 1;
  transform: translateX(0);
}

/* ===== Activity List ===== */
.activity-list {
  display: flex;
  flex-direction: column;
}

.activity-item {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 10px 0;
  border-bottom: 1px solid var(--border);
}

.activity-item:last-child {
  border-bottom: none;
}

.activity-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  margin-top: 5px;
  flex-shrink: 0;
}

.dot-info {
  background: var(--info);
  box-shadow: 0 0 8px rgba(79, 142, 247, 0.4);
}

.dot-danger {
  background: var(--danger);
  box-shadow: 0 0 8px rgba(224, 92, 92, 0.4);
}

.dot-success {
  background: var(--success);
  box-shadow: 0 0 8px rgba(16, 185, 129, 0.4);
}

.dot-warning {
  background: var(--warning);
  box-shadow: 0 0 8px rgba(245, 158, 11, 0.4);
}

.activity-content {
  flex: 1;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 8px;
  min-width: 0;
}

.activity-text {
  font-size: 13px;
  color: var(--text-secondary);
  line-height: 1.4;
}

.activity-text strong {
  color: var(--text-primary);
  font-weight: 600;
}

.activity-time {
  font-size: 11px;
  color: var(--text-muted);
  white-space: nowrap;
  flex-shrink: 0;
}

/* ===== Quick Actions ===== */
.quick-actions-list {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.quick-action-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 11px 14px;
  border-radius: var(--radius-sm);
  text-decoration: none;
  color: var(--text-secondary);
  font-size: 13px;
  font-weight: 500;
  transition: all 0.2s var(--transition-default);
  border: 1px solid transparent;
  background: transparent;
}

.quick-action-item:hover {
  background: var(--bg-hover);
  color: var(--primary);
  border-color: var(--border);
  transform: translateX(4px);
}

.quick-action-icon {
  width: 34px;
  height: 34px;
  border-radius: var(--radius-sm);
  background: var(--primary-glow);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  flex-shrink: 0;
  transition: all 0.2s ease;
}

.quick-action-item:hover .quick-action-icon {
  background: var(--primary-glow-strong);
  transform: scale(1.05);
}

.quick-action-text {
  flex: 1;
}

.quick-action-item svg {
  color: var(--text-muted);
  opacity: 0;
  transform: translateX(-4px);
  transition: all 0.2s ease;
  flex-shrink: 0;
}

.quick-action-item:hover svg {
  opacity: 1;
  transform: translateX(0);
  color: var(--primary);
}
</style>
{% endblock %}